<!-- profile.html -->
{% extends 'base.html' %}
{% load static humanize %}

{% block title %}{{ profile_user.username }} - Baysoko{% endblock %}

{% block extra_css %}
<style>
    .profile-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: var(--spacing-md);
    }

    /* Profile Header Card - Revamped */
    .profile-header-card {
        background: linear-gradient(145deg, var(--card-bg) 0%, var(--bg-secondary) 100%);
        border-radius: var(--radius-xl);
        padding: var(--spacing-xl);
        margin-bottom: var(--spacing-lg);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
    }

    .profile-header-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    }

    .profile-header-content {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: var(--spacing-xl);
        align-items: start;
    }

    .profile-avatar-section {
        position: relative;
    }

    .profile-avatar {
        width: 140px;
        height: 140px;
        border-radius: var(--radius-full);
        object-fit: cover;
        border: 5px solid var(--card-bg);
        box-shadow: var(--shadow-xl);
        background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent) 100%);
        position: relative;
        z-index: 2;
    }

    .profile-avatar-ring {
        position: absolute;
        top: -8px;
        left: -8px;
        right: -8px;
        bottom: -8px;
        border-radius: var(--radius-full);
        border: 3px solid rgba(255, 107, 53, 0.3);
        z-index: 1;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); opacity: 0.3; }
        50% { transform: scale(1.05); opacity: 0.5; }
        100% { transform: scale(1); opacity: 0.3; }
    }

    .profile-info-section {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }

    .profile-name-row {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        flex-wrap: wrap;
    }

    .profile-name {
        font-family: var(--font-heading);
        font-size: 2rem;
        font-weight: 800;
        color: var(--text-primary);
        line-height: 1.2;
        margin: 0;
    }

    .profile-username {
        font-size: 1.125rem;
        color: var(--text-secondary);
        font-weight: 500;
        background: var(--bg-secondary);
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-color);
    }

    .profile-bio {
        font-size: 1rem;
        color: var(--text-secondary);
        line-height: 1.6;
        max-width: 800px;
        padding: var(--spacing-sm) 0;
    }

    /* Stats Card - Unified Design */
    .stats-card {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-md);
        margin-top: var(--spacing-md);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-md);
    }

    .stat-item {
        text-align: center;
        padding: var(--spacing-md);
        border-radius: var(--radius-md);
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        min-height: 100px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .stat-item:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
        border-color: var(--primary);
    }

    .stat-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        border-radius: var(--radius-md) var(--radius-md) 0 0;
    }

    .stat-item:nth-child(1)::before { background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%); }
    .stat-item:nth-child(2)::before { background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%); }
    .stat-item:nth-child(3)::before { background: linear-gradient(90deg, var(--success) 0%, var(--success-light) 100%); }
    .stat-item:nth-child(4)::before { background: linear-gradient(90deg, var(--warning) 0%, var(--warning-light) 100%); }

    .stat-value {
        font-size: 2rem;
        font-weight: 800;
        margin-bottom: var(--spacing-xs);
        font-family: var(--font-heading);
        line-height: 1;
    }

    .stat-item:nth-child(1) .stat-value { color: var(--primary); }
    .stat-item:nth-child(2) .stat-value { color: var(--accent); }
    .stat-item:nth-child(3) .stat-value { color: var(--success); }
    .stat-item:nth-child(4) .stat-value { color: var(--warning); }

    .stat-label {
        color: var(--text-secondary);
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .stat-icon {
        font-size: 1rem;
    }

    .stat-item:nth-child(1) .stat-icon { color: var(--primary); }
    .stat-item:nth-child(2) .stat-icon { color: var(--accent); }
    .stat-item:nth-child(3) .stat-icon { color: var(--success); }
    .stat-item:nth-child(4) .stat-icon { color: var(--warning); }

    /* Profile Actions */
    .profile-actions {
        display: flex;
        gap: var(--spacing-sm);
        flex-wrap: wrap;
        margin-top: var(--spacing-lg);
        padding-top: var(--spacing-md);
        border-top: 1px solid var(--border-color);
    }

    /* Profile Content */
    .profile-content {
        background: var(--card-bg);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        overflow: hidden;
        margin-top: var(--spacing-lg);
    }

    /* Tabs Container - Horizontal Scroll on Mobile */
    .tabs-container {
        position: relative;
        overflow: hidden;
    }

    .profile-tabs-scroll {
        display: flex;
        border-bottom: 1px solid var(--border-color);
        background: var(--card-bg);
        padding: 0 var(--spacing-md);
        overflow-x: auto;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
    }

    .profile-tabs-scroll::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
    }

    .profile-tab {
        padding: var(--spacing-md) var(--spacing-lg);
        background: none;
        border: none;
        color: var(--text-secondary);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        border-bottom: 3px solid transparent;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        font-size: 0.95rem;
        font-family: var(--font-heading);
        position: relative;
        flex-shrink: 0;
    }

    .profile-tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
        background: linear-gradient(to bottom, rgba(255, 107, 53, 0.05), transparent);
    }

    .profile-tab:hover {
        color: var(--primary);
        background: rgba(255, 107, 53, 0.05);
    }

    .tab-badge {
        background: var(--primary);
        color: white;
        border-radius: 20px;
        padding: 0.25rem 0.625rem;
        font-size: 0.75rem;
        font-weight: 700;
        min-width: 24px;
        text-align: center;
    }

    .tab-content {
        padding: var(--spacing-xl);
    }

    .tab-pane {
        display: none;
        animation: fadeIn 0.3s ease;
    }

    .tab-pane.active {
        display: block;
    }

    /* Scroll indicators */
    .scroll-indicator {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(to right, var(--card-bg), transparent);
        z-index: 10;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .scroll-indicator.left {
        left: 0;
    }

    .scroll-indicator.right {
        right: 0;
        background: linear-gradient(to left, var(--card-bg), transparent);
    }

    .scroll-indicator.visible {
        opacity: 1;
        pointer-events: auto;
    }

    .scroll-btn {
        width: 32px;
        height: 32px;
        border-radius: var(--radius-full);
        background: var(--primary);
        color: white;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        pointer-events: auto;
        box-shadow: var(--shadow-md);
        transition: var(--transition);
    }

    .scroll-btn:hover {
        background: var(--primary-dark);
        transform: scale(1.1);
    }

    /* Listings Grid */
    .listings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: var(--spacing-md);
    }

    .listing-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        overflow: hidden;
        transition: var(--transition);
        box-shadow: var(--shadow-sm);
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .listing-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary);
    }

    .listing-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        background: var(--bg-secondary);
    }

    .listing-content {
        padding: var(--spacing-md);
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .listing-title {
        font-weight: 600;
        margin-bottom: var(--spacing-sm);
        color: var(--text-primary);
        font-size: 1.125rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        flex: 1;
    }

    .listing-price {
        font-size: 1.25rem;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: var(--spacing-md);
        font-family: var(--font-heading);
    }

    .listing-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
    }

    .listing-location {
        background: rgba(255, 107, 53, 0.1);
        color: var(--primary);
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-sm);
        font-size: 0.875rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .listing-stock {
        font-size: 0.875rem;
        font-weight: 700;
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-sm);
    }

    .in-stock {
        background: rgba(6, 214, 160, 0.1);
        color: var(--success);
    }

    .low-stock {
        background: rgba(255, 158, 31, 0.1);
        color: var(--warning);
    }

    .out-of-stock {
        background: rgba(239, 71, 111, 0.1);
        color: var(--danger);
    }

    .listing-actions {
        display: flex;
        gap: var(--spacing-sm);
        margin-top: auto;
    }

    .action-btn {
        flex: 1;
        padding: 0.75rem;
        border: none;
        border-radius: var(--radius-sm);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        text-decoration: none;
        font-family: var(--font-heading);
    }

    .view-btn {
        background: var(--primary);
        color: white;
    }

    .view-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        color: white;
    }

    .contact-info {
        background: var(--bg-secondary);
        border-radius: var(--radius-lg);
        padding: var(--spacing-xl);
        border: 1px solid var(--border-color);
    }

    .contact-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-md) 0;
        border-bottom: 1px solid var(--border-color);
    }

    .contact-item:last-child {
        border-bottom: none;
    }

    .contact-icon {
        width: 48px;
        height: 48px;
        background: var(--primary);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.25rem;
        flex-shrink: 0;
    }

    .contact-details h4 {
        margin: 0 0 var(--spacing-xs) 0;
        font-weight: 600;
        color: var(--text-primary);
        font-size: 1rem;
    }

    .contact-details p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.9375rem;
    }

    .contact-details a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition);
    }

    .contact-details a:hover {
        color: var(--primary-dark);
        text-decoration: underline;
    }

    .empty-state {
        text-align: center;
        padding: var(--spacing-xxl) var(--spacing-lg);
        color: var(--text-secondary);
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: var(--spacing-lg);
        color: var(--border-color);
        opacity: 0.5;
    }

    .empty-title {
        font-size: 1.5rem;
        margin-bottom: var(--spacing-md);
        font-weight: 700;
        color: var(--text-primary);
        font-family: var(--font-heading);
    }

    .empty-description {
        font-size: 1rem;
        margin-bottom: var(--spacing-xl);
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
    }

    .verification-badge {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: var(--shadow-sm);
        max-width: fit-content;
    }

    .member-since {
        color: var(--warning);
        font-weight: 700;
    }

    .store-section {
        margin-bottom: var(--spacing-xl);
        padding-bottom: var(--spacing-xl);
        border-bottom: 1px solid var(--border-color);
    }

    .store-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .store-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--spacing-lg);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive Styles */
    @media (max-width: 1024px) {
        .profile-header-content {
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
            text-align: center;
        }

        .profile-avatar-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
        }

        .profile-name-row {
            justify-content: center;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .profile-container {
            padding: var(--spacing-sm);
        }

        .profile-header-card {
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
        }

        .profile-name {
            font-size: 1.75rem;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
        }

        .stats-card {
            padding: var(--spacing-md);
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-sm);
        }

        .stat-item {
            padding: var(--spacing-sm);
            min-height: 80px;
        }

        .stat-value {
            font-size: 1.5rem;
        }

        .profile-actions {
            flex-direction: column;
            align-items: stretch;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .tabs-container {
            margin: 0 calc(-1 * var(--spacing-sm));
        }

        .profile-tabs-scroll {
            padding: 0 var(--spacing-sm);
        }

        .profile-tab {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.9rem;
        }

        .tab-content {
            padding: var(--spacing-lg);
        }

        .listings-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: var(--spacing-sm);
        }

        .listing-image {
            height: 180px;
        }

        .store-header {
            flex-direction: column;
            gap: var(--spacing-md);
            align-items: stretch;
        }
    }

    @media (max-width: 576px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .stat-item {
            min-height: 70px;
            flex-direction: row;
            justify-content: space-between;
            text-align: left;
            padding: var(--spacing-md);
        }

        .stat-value {
            margin-bottom: 0;
            font-size: 1.25rem;
        }

        .stat-label {
            text-align: right;
        }

        .listings-grid {
            grid-template-columns: 1fr;
        }

        .tab-content {
            padding: var(--spacing-md);
        }

        .listing-actions {
            flex-direction: column;
        }

        .scroll-indicator {
            display: none;
        }
    }

    @media (max-width: 480px) {
        .profile-container {
            padding: var(--spacing-xs);
        }

        .profile-header-card {
            padding: var(--spacing-md);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
        }

        .profile-name {
            font-size: 1.5rem;
        }

        .tab-content {
            padding: var(--spacing-sm);
        }

        .listing-card {
            margin-bottom: var(--spacing-sm);
        }

        .profile-actions .btn-custom {
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-container animate-fade-in">
    <!-- Profile Header Card - Revamped -->
    <div class="profile-header-card">
        <div class="profile-header-content">
            <!-- Avatar Section -->
            <div class="profile-avatar-section">
                {% if user == profile_user %}
                <a href="{% url 'profile-edit' profile_user.pk %}" title="Edit profile picture" class="d-inline-block position-relative">
                    <div class="profile-avatar-ring"></div>
                    <img src="{% if profile_user.get_profile_picture_url %}{{ profile_user.get_profile_picture_url }}{% else %}{% static 'images/default_profile_pic.svg' %}{% endif %}"
                         data-default="{% static 'images/default_profile_pic.svg' %}"
                         class="profile-avatar"
                         alt="{{ profile_user.username }}"
                         onerror="this.onerror=null;this.src=this.getAttribute('data-default');">
                </a>
                {% else %}
                <div class="position-relative">
                    <div class="profile-avatar-ring"></div>
                    <img src="{% if profile_user.get_profile_picture_url %}{{ profile_user.get_profile_picture_url }}{% else %}{% static 'images/default_profile_pic.svg' %}{% endif %}"
                         data-default="{% static 'images/default_profile_pic.svg' %}"
                         class="profile-avatar"
                         alt="{{ profile_user.username }}"
                         onerror="this.onerror=null;this.src=this.getAttribute('data-default');">
                </div>
                {% endif %}
            </div>

            <!-- Info Section -->
            <div class="profile-info-section">
                <div class="profile-name-row">
                    <h1 class="profile-name">
                        {% if profile_user.first_name and profile_user.last_name %}
                            {{ profile_user.first_name }} {{ profile_user.last_name }}
                        {% elif profile_user.first_name %}
                            {{ profile_user.first_name }}
                        {% else %}
                            {{ profile_user.username }}
                        {% endif %}
                    </h1>
                    <div class="profile-username">@{{ profile_user.username }}</div>
                </div>
                
                {% if profile_user.is_verified %}
                <div class="verification-badge mb-2">
                    <i class="bi bi-patch-check-fill"></i>
                    Verified Seller
                </div>
                {% endif %}
                
                {% if profile_user.bio %}
                <div class="profile-bio">{{ profile_user.bio }}</div>
                {% endif %}
                
                <!-- Unified Stats Card -->
                <div class="stats-card">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">{{ listing_count }}</div>
                            <div class="stat-label">
                                <i class="bi bi-grid stat-icon"></i>
                                Listings
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ saved_count }}</div>
                            <div class="stat-label">
                                <i class="bi bi-heart stat-icon"></i>
                                Saved
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ rating_average|floatformat:1 }}</div>
                            <div class="stat-label">
                                <i class="bi bi-star stat-icon"></i>
                                Rating
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value member-since">
                                {% if profile_user.date_joined %}
                                    {{ profile_user.date_joined|date:"M j, Y" }}
                                {% else %}
                                    {{ member_since }}
                                {% endif %}
                            </div>
                            <div class="stat-label">
                                <i class="bi bi-calendar stat-icon"></i>
                                Joined
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Actions -->
                {% if user == profile_user %}
                <div class="profile-actions">
                    <a href="{% url 'profile-edit' profile_user.pk %}" class="btn-custom btn-primary">
                        <i class="bi bi-pencil"></i>
                        Edit Profile
                    </a>
                    <a href="{% url 'listing-create' %}" class="btn-custom btn-accent">
                        <i class="bi bi-plus-circle"></i>
                        Create Listing
                    </a>
                    <a href="{% url 'password_change' %}" class="btn-custom btn-ghost">
                        <i class="bi bi-shield-lock"></i>
                        Change Password
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Profile Content -->
    <div class="profile-content">
        <!-- Tabs Container with Scroll -->
        <div class="tabs-container">
            <div class="scroll-indicator left">
                <button class="scroll-btn scroll-left">
                    <i class="bi bi-chevron-left"></i>
                </button>
            </div>
            
            <div class="profile-tabs-scroll" id="profileTabs">
                <button class="profile-tab active" data-tab="listings">
                    <i class="bi bi-grid"></i>
                    <span>Listings</span>
                    <span class="tab-badge">{{ listing_count }}</span>
                </button>
                
                {% if user == profile_user %}
                <button class="profile-tab" data-tab="saved">
                    <i class="bi bi-heart"></i>
                    <span>Saved Items</span>
                    <span class="tab-badge">{{ saved_count }}</span>
                </button>
                <button class="profile-tab" data-tab="contact">
                    <i class="bi bi-person-lines-fill"></i>
                    <span>Contact Info</span>
                </button>
                {% else %}
                <button class="profile-tab" data-tab="contact">
                    <i class="bi bi-chat-dots"></i>
                    <span>Contact Seller</span>
                </button>
                {% endif %}
            </div>
            
            <div class="scroll-indicator right">
                <button class="scroll-btn scroll-right">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Listings Tab -->
            <div class="tab-pane active" id="listings-tab">
                {% if stores %}
                    {% for store in stores %}
                    <div class="store-section">
                        <div class="store-header">
                            <div>
                                <h3 class="h5 fw-bold mb-2">{{ store.name }}</h3>
                                {% if store.description %}
                                <p class="text-muted mb-0">{{ store.description|truncatechars:100 }}</p>
                                {% endif %}
                            </div>
                            <a href="{% url 'storefront:store_detail' slug=store.slug %}" class="btn-custom btn-ghost">
                                <i class="bi bi-shop"></i>
                                View Store
                            </a>
                        </div>
                        
                        {% if store.listings.exists %}
                        <div class="listings-grid">
                            {% for listing in store.listings.all %}
                            <div class="listing-card">
                                <img src="{{ listing.get_image_url }}" class="listing-image" alt="{{ listing.title }}">
                                <div class="listing-content">
                                    <h3 class="listing-title">{{ listing.title }}</h3>
                                    <div class="listing-price">KSh {{ listing.price|intcomma }}</div>
                                    <div class="listing-meta">
                                        <span class="listing-location">
                                            <i class="bi bi-geo-alt"></i>
                                            {{ listing.get_location_display }}
                                        </span>
                                        <span class="listing-stock {% if listing.stock > 10 %}in-stock{% elif listing.stock > 0 %}low-stock{% else %}out-of-stock{% endif %}">
                                            {% if listing.stock > 10 %}
                                                In Stock
                                            {% elif listing.stock > 0 %}
                                                Low Stock
                                            {% else %}
                                                Out of Stock
                                            {% endif %}
                                        </span>
                                    </div>
                                    <div class="listing-actions">
                                        <a href="{% url 'listing-detail' listing.pk %}" class="action-btn view-btn">
                                            <i class="bi bi-eye"></i>
                                            View
                                        </a>
                                        {% if user.is_authenticated and user != profile_user %}
                                        <button class="action-btn btn-custom btn-ghost like-btn" data-listing-id="{{ listing.id }}">
                                            <i class="bi bi-heart{% if listing.id in user_favorites %}-fill text-danger{% endif %}"></i>
                                            Save
                                        </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="bi bi-inboxes empty-icon"></i>
                            <h3 class="empty-title">No listings in this store</h3>
                            <p class="empty-description">This store doesn't have any active listings yet.</p>
                            {% if user == profile_user %}
                            <a href="{% url 'storefront:product_create' store_slug=store.slug %}" class="btn-custom btn-primary mt-3">
                                <i class="bi bi-plus-circle"></i>
                                Add Your First Listing
                            </a>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    
                    <!-- Pagination -->
                    {% if page_obj.has_other_pages %}
                    <div class="d-flex justify-content-center mt-4 pt-4 border-top">
                        <nav aria-label="Page navigation">
                            <ul class="pagination mb-0">
                                {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                                        <i class="bi bi-chevron-left"></i>
                                    </a>
                                </li>
                                {% endif %}
                                
                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                                        <i class="bi bi-chevron-right"></i>
                                    </a>
                                </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                    {% endif %}
                {% else %}
                <div class="empty-state">
                    <i class="bi bi-shop empty-icon"></i>
                    <h3 class="empty-title">No stores yet</h3>
                    <p class="empty-description">
                        {% if user == profile_user %}
                        You haven't created any stores yet. Start by creating your first store to list your products.
                        {% else %}
                        This user hasn't created any stores yet.
                        {% endif %}
                    </p>
                    {% if user == profile_user %}
                    <a href="{% url 'storefront:store_create' %}" class="btn-custom btn-primary mt-3">
                        <i class="bi bi-plus-circle"></i>
                        Create Your First Store
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <!-- Saved Items Tab (only for profile owner) -->
            {% if user == profile_user %}
            <div class="tab-pane" id="saved-tab">
                {% if saved_listings %}
                <div class="listings-grid">
                    {% for listing in saved_listings %}
                    <div class="listing-card">
                        <img src="{{ listing.get_image_url }}" class="listing-image" alt="{{ listing.title }}">
                        <div class="listing-content">
                            <h3 class="listing-title">{{ listing.title }}</h3>
                            <div class="listing-price">KSh {{ listing.price|intcomma }}</div>
                            <div class="listing-meta">
                                <span class="listing-location">
                                    <i class="bi bi-geo-alt"></i>
                                    {{ listing.get_location_display }}
                                </span>
                                <span class="listing-stock {% if listing.stock > 10 %}in-stock{% elif listing.stock > 0 %}low-stock{% else %}out-of-stock{% endif %}">
                                    {% if listing.stock > 10 %}
                                        In Stock
                                    {% elif listing.stock > 0 %}
                                        Low Stock
                                    {% else %}
                                        Out of Stock
                                    {% endif %}
                                </span>
                            </div>
                            <div class="listing-actions">
                                <a href="{% url 'listing-detail' listing.pk %}" class="action-btn view-btn">
                                    <i class="bi bi-eye"></i>
                                    View
                                </a>
                                <button class="action-btn btn-custom btn-ghost like-btn" data-listing-id="{{ listing.id }}">
                                    <i class="bi bi-heart-fill text-danger"></i>
                                    Remove
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="bi bi-bookmark-heart empty-icon"></i>
                    <h3 class="empty-title">No saved items</h3>
                    <p class="empty-description">Items you save will appear here for quick access.</p>
                    <a href="{% url 'all-listings' %}" class="btn-custom btn-primary mt-3">
                        <i class="bi bi-search"></i>
                        Browse Listings
                    </a>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Contact Info Tab -->
            <div class="tab-pane" id="contact-tab">
                {% if profile_user.phone_number or profile_user.email or profile_user.location %}
                <div class="contact-info">
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-person"></i>
                        </div>
                        <div class="contact-details">
                            <h4>Name</h4>
                            <p>
                                {% if profile_user.first_name and profile_user.last_name %}
                                    {{ profile_user.first_name }} {{ profile_user.last_name }}
                                {% elif profile_user.first_name %}
                                    {{ profile_user.first_name }}
                                {% else %}
                                    Not provided
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    
                    {% if profile_user.phone_number and profile_user.show_contact_info %}
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-phone"></i>
                        </div>
                        <div class="contact-details">
                            <h4>Phone Number</h4>
                            <p>
                                {% if user == profile_user or profile_user.show_contact_info %}
                                    <a href="tel:{{ profile_user.phone_number }}">{{ profile_user.phone_number }}</a>
                                {% else %}
                                    <em>Contact info hidden</em>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile_user.email and profile_user.show_contact_info %}
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-envelope"></i>
                        </div>
                        <div class="contact-details">
                            <h4>Email Address</h4>
                            <p>
                                {% if user == profile_user or profile_user.show_contact_info %}
                                    <a href="mailto:{{ profile_user.email }}">{{ profile_user.email }}</a>
                                {% else %}
                                    <em>Contact info hidden</em>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile_user.location %}
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-geo-alt"></i>
                        </div>
                        <div class="contact-details">
                            <h4>Location</h4>
                            <p>{{ profile_user.location }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if user == profile_user %}
                    <div class="text-center mt-4 pt-3 border-top">
                        <a href="{% url 'profile-edit' profile_user.pk %}" class="btn-custom btn-primary">
                            <i class="bi bi-pencil"></i>
                            Edit Contact Information
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="bi bi-person-x empty-icon"></i>
                    <h3 class="empty-title">No contact information</h3>
                    <p class="empty-description">
                        {% if user == profile_user %}
                        You haven't added any contact information yet. Add your contact details to help buyers reach you.
                        {% else %}
                        This user hasn't made their contact information available.
                        {% endif %}
                    </p>
                    {% if user == profile_user %}
                    <a href="{% url 'profile-edit' profile_user.pk %}" class="btn-custom btn-primary mt-3">
                        <i class="bi bi-plus-circle"></i>
                        Add Contact Information
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab functionality
        const tabs = document.querySelectorAll('.profile-tab');
        const tabPanes = document.querySelectorAll('.tab-pane');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => {
                    t.classList.remove('active');
                    t.setAttribute('aria-selected', 'false');
                });
                this.classList.add('active');
                this.setAttribute('aria-selected', 'true');
                
                // Show target tab content
                tabPanes.forEach(pane => {
                    pane.classList.remove('active');
                    pane.setAttribute('aria-hidden', 'true');
                    if (pane.id === `${targetTab}-tab`) {
                        pane.classList.add('active');
                        pane.setAttribute('aria-hidden', 'false');
                    }
                });
                
                // Add animation class
                const activePane = document.getElementById(`${targetTab}-tab`);
                if (activePane) {
                    activePane.style.animation = 'none';
                    setTimeout(() => {
                        activePane.style.animation = 'fadeIn 0.3s ease';
                    }, 10);
                }
            });
        });
        
        // Tab scrolling functionality
        const tabsContainer = document.getElementById('profileTabs');
        const scrollLeftBtn = document.querySelector('.scroll-left');
        const scrollRightBtn = document.querySelector('.scroll-right');
        const leftIndicator = document.querySelector('.scroll-indicator.left');
        const rightIndicator = document.querySelector('.scroll-indicator.right');
        
        function updateScrollIndicators() {
            const scrollLeft = tabsContainer.scrollLeft;
            const maxScrollLeft = tabsContainer.scrollWidth - tabsContainer.clientWidth;
            
            if (scrollLeft > 0) {
                leftIndicator.classList.add('visible');
            } else {
                leftIndicator.classList.remove('visible');
            }
            
            if (scrollLeft < maxScrollLeft - 10) {
                rightIndicator.classList.add('visible');
            } else {
                rightIndicator.classList.remove('visible');
            }
        }
        
        if (scrollLeftBtn && scrollRightBtn) {
            scrollLeftBtn.addEventListener('click', () => {
                tabsContainer.scrollBy({ left: -200, behavior: 'smooth' });
            });
            
            scrollRightBtn.addEventListener('click', () => {
                tabsContainer.scrollBy({ left: 200, behavior: 'smooth' });
            });
            
            tabsContainer.addEventListener('scroll', updateScrollIndicators);
            window.addEventListener('resize', updateScrollIndicators);
            
            // Initial check
            updateScrollIndicators();
        }
        
        // Like button functionality
        const likeButtons = document.querySelectorAll('.like-btn');
        
        likeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const listingId = this.getAttribute('data-listing-id');
                const csrfToken = getCookie('csrftoken');
                const icon = this.querySelector('i');
                
                // Visual feedback
                this.style.transform = 'scale(0.95)';
                this.disabled = true;
                
                fetch("{% url 'toggle_favorite' 0 %}".replace('0', listingId), {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                        this.disabled = false;
                    }, 150);
                    
                    if (data.is_favorited) {
                        // Update icon for heart
                        if (icon) {
                            icon.className = 'bi bi-heart-fill text-danger';
                            if (this.textContent.includes('Save')) {
                                this.innerHTML = '<i class="bi bi-heart-fill text-danger"></i> Remove';
                            }
                        }
                    } else {
                        // Update icon for unhearted
                        if (icon) {
                            icon.className = 'bi bi-heart';
                            if (this.textContent.includes('Remove')) {
                                this.innerHTML = '<i class="bi bi-heart"></i> Save';
                            }
                        }
                        // Remove from saved items view
                        if (this.closest('#saved-tab')) {
                            const card = this.closest('.listing-card');
                            card.style.opacity = '0.5';
                            card.style.transform = 'scale(0.95)';
                            setTimeout(() => {
                                card.remove();
                                // Update empty state if needed
                                const savedItems = document.querySelectorAll('#saved-tab .listing-card');
                                if (savedItems.length === 0) {
                                    // Reload to show empty state
                                    const savedTab = document.getElementById('saved-tab');
                                    savedTab.innerHTML = `
                                        <div class="empty-state">
                                            <i class="bi bi-bookmark-heart empty-icon"></i>
                                            <h3 class="empty-title">No saved items</h3>
                                            <p class="empty-description">Items you save will appear here for quick access.</p>
                                            <a href="{% url 'all-listings' %}" class="btn-custom btn-primary mt-3">
                                                <i class="bi bi-search"></i>
                                                Browse Listings
                                            </a>
                                        </div>
                                    `;
                                }
                            }, 300);
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    this.disabled = false;
                    this.style.transform = 'scale(1)';
                });
            });
        });
        
        // Initialize tab accessibility
        tabs.forEach((tab, index) => {
            tab.setAttribute('role', 'tab');
            tab.setAttribute('id', `tab-${index}`);
            if (index === 0) {
                tab.setAttribute('aria-selected', 'true');
            } else {
                tab.setAttribute('aria-selected', 'false');
            }
        });
        
        tabPanes.forEach((pane, index) => {
            pane.setAttribute('role', 'tabpanel');
            pane.setAttribute('aria-labelledby', `tab-${index}`);
            if (index === 0) {
                pane.setAttribute('aria-hidden', 'false');
            } else {
                pane.setAttribute('aria-hidden', 'true');
            }
        });
    });
    
    // Helper function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
{% endblock %}