{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Blog - Baysoko Marketplace{% endblock %}

{% block extra_css %}
<style>
    /* ===== BLOG LIST PAGE STYLES ===== */
    
    /* Global Container */
    .container-custom {
        padding-left: 8px;
        padding-right: 8px;
    }
    
    /* ===== BREADCRUMB ===== */
    .breadcrumb {
        background: var(--bg-secondary);
        padding: 10px 12px;
        border-radius: var(--radius-md);
        margin-bottom: 16px;
        border: 1px solid var(--border-color);
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        font-size: 12px;
    }
    
    .breadcrumb-item a {
        text-decoration: none;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 11px;
    }
    
    /* ===== BLOG HERO SECTION ===== */
    .blog-hero-section {
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        color: white;
        padding: 40px 0 30px;
        margin-bottom: 24px;
        border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        position: relative;
        overflow: hidden;
    }
    
    .blog-hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
    }
    
    .blog-hero-content {
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
        position: relative;
        z-index: 1;
    }
    
    .blog-hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        margin-bottom: 16px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        font-weight: 600;
    }
    
    .blog-hero-title {
        font-size: 28px;
        font-weight: 800;
        margin-bottom: 12px;
        line-height: 1.2;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    .blog-hero-subtitle {
        font-size: 14px;
        opacity: 0.9;
        line-height: 1.6;
        margin-bottom: 20px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* ===== ENHANCED SEARCH BAR ===== */
    .blog-search-container {
        max-width: 600px;
        margin: 0 auto 20px;
        position: relative;
    }
    
    .blog-search-wrapper {
        position: relative;
        margin-bottom: 12px;
    }
    
    .blog-search-input {
        width: 100%;
        padding: 14px 52px 14px 16px;
        border-radius: var(--radius-lg);
        border: 2px solid rgba(255, 255, 255, 0.25);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 14px;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        box-sizing: border-box;
    }
    
    .blog-search-input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }
    
    .blog-search-input:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: white;
        outline: none;
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
    }
    
    /* Single search button (arrow only) */
    .blog-search-button {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        color: white;
        font-size: 16px;
        background: rgba(255, 255, 255, 0.15);
        border: none;
        width: 36px;
        height: 36px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
        z-index: 2;
    }
    
    .blog-search-button:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-50%) scale(1.05);
    }
    
    .blog-search-button:active {
        transform: translateY(-50%) scale(0.95);
    }
    
    /* Clear functionality integrated into search button */
    .blog-search-button.clear-mode {
        background: rgba(255, 255, 255, 0.2);
    }
    
    .blog-search-button.clear-mode:hover {
        background: rgba(255, 255, 255, 0.3);
    }
    
    .blog-search-category {
        width: 100%;
        appearance: none;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.2);
        padding: 12px 16px;
        border-radius: var(--radius-md);
        font-size: 13px;
        transition: all 0.2s ease;
        cursor: pointer;
        backdrop-filter: blur(10px);
    }
    
    .blog-search-category option {
        background: rgba(0, 0, 0, 0.9);
        color: white;
    }
    
    .blog-search-category:focus {
        border-color: rgba(255, 255, 255, 0.4);
        outline: none;
        background: rgba(255, 255, 255, 0.15);
    }
    
    /* ===== FIXED SEARCH RESULTS PANEL ===== */
    .search-results-panel {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.98);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-md);
        max-height: 350px;
        overflow-y: auto;
        z-index: 9999; /* Increased z-index to be above hero */
        backdrop-filter: blur(20px);
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
        display: none;
        /* Ensure it's above hero section */
        position: relative;
    }
    
    .blog-search-wrapper {
        position: relative;
        z-index: 10000; /* Ensure input is above everything */
    }
    
    .search-results-panel.visible {
        display: block;
        animation: slideDown 0.2s ease-out;
    }
    
    /* Show first 3 results without scroll, then scrollable */
    .search-results-panel:not(.has-many-results) {
        max-height: none;
        overflow-y: visible;
    }
    
    .search-results-panel.has-many-results {
        max-height: 350px;
        overflow-y: auto;
    }
    
    .search-results-panel.has-many-results::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 40px;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
        pointer-events: none;
        border-radius: 0 0 var(--radius-md) var(--radius-md);
    }
    
    .search-result-item {
        display: flex;
        gap: 12px;
        padding: 12px;
        align-items: center;
        border-radius: var(--radius-sm);
        transition: all 0.2s ease;
        text-decoration: none;
        color: white;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .search-result-item:last-child {
        border-bottom: none;
    }
    
    .search-result-item:hover {
        background: rgba(255, 255, 255, 0.05);
    }
    
    .search-result-image {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        flex-shrink: 0;
    }
    
    .search-result-content {
        flex: 1;
        min-width: 0;
    }
    
    .search-result-title {
        font-weight: 700;
        font-size: 13px;
        margin-bottom: 4px;
        line-height: 1.4;
        color: white;
    }
    
    .search-result-excerpt {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.4;
        margin-bottom: 4px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .search-result-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        color: var(--primary-light);
    }
    
    .results-count {
        padding: 8px 12px;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.6);
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(255, 255, 255, 0.03);
    }
    
    /* ===== IMPROVED SEARCH HISTORY ===== */
    .search-history-container {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .search-history-title {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .search-history-title i {
        font-size: 11px;
    }
    
    .search-history-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    
    .search-history-item {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .search-history-item:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
    }
    
    .remove-history-btn {
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.5);
        width: 16px;
        height: 16px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        cursor: pointer;
        padding: 0;
        transition: all 0.2s ease;
        margin-left: 4px;
    }
    
    .remove-history-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        transform: scale(1.1);
    }
    
    /* ===== BLOG POSTS GRID ===== */
    .blog-posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }
    
    .blog-post-card {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    
    .blog-post-card:hover {
        transform: translateY(-6px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary);
    }
    
    .blog-post-image {
        position: relative;
        height: 180px;
        overflow: hidden;
    }
    
    .blog-post-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .blog-post-card:hover .blog-post-image img {
        transform: scale(1.05);
    }
    
    .blog-post-badges {
        position: absolute;
        top: 10px;
        left: 10px;
        right: 10px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        z-index: 2;
    }
    
    .blog-category-tag {
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 11px;
        font-weight: 700;
        backdrop-filter: blur(20px);
        display: flex;
        align-items: center;
        gap: 4px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .blog-featured-tag {
        background: linear-gradient(135deg, var(--danger) 0%, #e63946 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 11px;
        font-weight: 700;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .blog-post-content {
        padding: 16px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .blog-post-title {
        font-weight: 800;
        font-size: 16px;
        margin-bottom: 10px;
        line-height: 1.4;
        color: var(--text-primary);
    }
    
    .blog-post-title a {
        color: inherit;
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .blog-post-title a:hover {
        color: var(--primary);
    }
    
    .blog-post-excerpt {
        color: var(--text-secondary);
        font-size: 13px;
        line-height: 1.6;
        margin-bottom: 16px;
        flex-grow: 1;
    }
    
    .blog-post-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
        color: var(--text-secondary);
        margin-top: auto;
        padding-top: 12px;
        border-top: 1px solid var(--border-color);
    }
    
    .blog-post-author {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .blog-author-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--border-color);
    }
    
    .blog-post-stats {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .blog-post-stat {
        display: flex;
        align-items: center;
        gap: 4px;
        font-weight: 600;
    }
    
    .blog-post-stat i {
        font-size: 13px;
    }
    
    .blog-post-stat.views { color: var(--primary); }
    .blog-post-stat.likes { color: var(--danger); }
    .blog-post-stat.comments { color: var(--success); }
    
    /* ===== SIDEBAR ===== */
    .sticky-sidebar {
        position: sticky;
        top: 80px;
    }
    
    .info-card {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: 16px;
        box-shadow: var(--shadow-sm);
        margin-bottom: 16px;
        border: 1px solid var(--border-color);
        transition: all 0.2s ease;
    }
    
    .info-card:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }
    
    .sidebar-title {
        font-size: 15px;
        font-weight: 800;
        margin-bottom: 14px;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .sidebar-title i {
        color: var(--primary);
        background: rgba(255, 107, 53, 0.1);
        padding: 8px;
        border-radius: 8px;
        font-size: 14px;
    }
    
    /* Categories List */
    .categories-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .category-item {
        padding: 10px 12px;
        border-radius: var(--radius-md);
        margin-bottom: 6px;
        transition: all 0.2s ease;
        border: 1px solid transparent;
    }
    
    .category-item:hover {
        background: var(--bg-secondary);
        border-color: var(--border-color);
    }
    
    .category-item.active {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        border-color: var(--primary);
    }
    
    .category-item.active a {
        color: white;
    }
    
    .category-item.active .category-count {
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }
    
    .category-item a {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--text-primary);
        text-decoration: none;
        font-size: 13px;
        font-weight: 600;
    }
    
    .category-count {
        background: var(--bg-secondary);
        color: var(--primary);
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 800;
        min-width: 24px;
        text-align: center;
    }
    
    /* Recent Posts List */
    .recent-posts-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .recent-post-item {
        display: flex;
        gap: 12px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border-color);
        transition: all 0.2s ease;
    }
    
    .recent-post-item:hover {
        transform: translateX(4px);
    }
    
    .recent-post-item:last-child {
        border-bottom: none;
    }
    
    .recent-post-image {
        width: 60px;
        height: 60px;
        border-radius: var(--radius-sm);
        object-fit: cover;
        flex-shrink: 0;
        border: 1px solid var(--border-color);
    }
    
    .recent-post-info {
        flex: 1;
    }
    
    .recent-post-title {
        font-size: 13px;
        font-weight: 700;
        margin-bottom: 4px;
        line-height: 1.4;
    }
    
    .recent-post-title a {
        color: var(--text-primary);
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .recent-post-title a:hover {
        color: var(--primary);
    }
    
    .recent-post-date {
        font-size: 11px;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    /* Create Post Card */
    .create-post-card {
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        border-radius: var(--radius-lg);
        padding: 20px;
        text-align: center;
        color: white;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(255, 107, 53, 0.2);
        position: relative;
        overflow: hidden;
    }
    
    .create-post-card::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        transform: rotate(30deg);
    }
    
    .create-post-card i {
        font-size: 40px;
        margin-bottom: 12px;
        position: relative;
        z-index: 1;
        opacity: 0.9;
    }
    
    .create-post-card h5 {
        font-size: 16px;
        font-weight: 800;
        margin-bottom: 8px;
        position: relative;
        z-index: 1;
    }
    
    .create-post-card p {
        font-size: 13px;
        opacity: 0.9;
        margin-bottom: 16px;
        position: relative;
        z-index: 1;
    }
    
    .create-post-card .btn-custom {
        background: white;
        color: var(--primary);
        font-weight: 700;
        position: relative;
        z-index: 1;
        transition: all 0.2s ease;
    }
    
    .create-post-card .btn-custom:hover {
        background: rgba(255, 255, 255, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* ===== EMPTY STATE ===== */
    .empty-blog-state {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: 40px 20px;
        border: 2px dashed var(--border-color);
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .empty-blog-state:hover {
        border-color: var(--primary);
        border-style: solid;
        transform: translateY(-2px);
    }
    
    .empty-blog-icon {
        font-size: 48px;
        color: var(--text-tertiary);
        margin-bottom: 16px;
        opacity: 0.5;
    }
    
    .empty-blog-title {
        font-size: 20px;
        font-weight: 800;
        margin-bottom: 10px;
        color: var(--text-primary);
    }
    
    .empty-blog-description {
        color: var(--text-secondary);
        margin-bottom: 20px;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
        font-size: 14px;
        line-height: 1.6;
    }
    
    /* ===== PAGINATION ===== */
    .blog-pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin-top: 30px;
        flex-wrap: wrap;
    }
    
    .page-link {
        padding: 8px 14px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-color);
        background: var(--card-bg);
        color: var(--text-primary);
        text-decoration: none;
        font-weight: 700;
        font-size: 13px;
        transition: all 0.2s ease;
        min-width: 36px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .page-link:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
    }
    
    .page-link.active {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        border-color: var(--primary);
        box-shadow: 0 4px 8px rgba(255, 107, 53, 0.3);
    }
    
    .page-link.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .page-link.disabled:hover {
        background: var(--card-bg);
        color: var(--text-primary);
        border-color: var(--border-color);
        transform: none;
        box-shadow: none;
    }
    
    /* ===== USER POSTS SECTION ===== */
    .user-posts-card {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: 16px;
        box-shadow: var(--shadow-sm);
        margin-bottom: 20px;
        border: 1px solid var(--border-color);
        position: relative;
        overflow: hidden;
    }
    
    .user-posts-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--success), var(--accent));
    }
    
    .user-posts-list {
        margin: 0;
        padding: 0;
    }
    
    .user-post-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px;
        margin-bottom: 8px;
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        border: 1px solid var(--border-color);
        transition: all 0.2s ease;
    }
    
    .user-post-item:hover {
        border-color: var(--primary);
        transform: translateX(4px);
    }
    
    .user-post-info h6 {
        font-size: 13px;
        font-weight: 700;
        margin-bottom: 6px;
        color: var(--text-primary);
    }
    
    .user-post-info h6 a {
        color: inherit;
        text-decoration: none;
        transition: color 0.2s ease;
    }
    
    .user-post-info h6 a:hover {
        color: var(--primary);
    }
    
    .user-post-meta {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .user-post-status {
        font-size: 11px;
        font-weight: 700;
        padding: 3px 8px;
        border-radius: 10px;
    }
    
    .user-post-status.published {
        background: rgba(52, 168, 83, 0.1);
        color: var(--success);
        border: 1px solid rgba(52, 168, 83, 0.2);
    }
    
    .user-post-status.draft {
        background: rgba(251, 188, 4, 0.1);
        color: var(--warning);
        border: 1px solid rgba(251, 188, 4, 0.2);
    }
    
    .user-post-meta small {
        font-size: 11px;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 3px;
    }
    
    /* ===== SECTION HEADER ===== */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 2px solid var(--border-color);
    }
    
    .section-header h4 {
        font-size: 18px;
        font-weight: 800;
        margin: 0;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .section-header h4 i {
        color: var(--primary);
        background: rgba(255, 107, 53, 0.1);
        padding: 8px;
        border-radius: 8px;
        font-size: 14px;
    }
    
    /* ===== ANIMATIONS ===== */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .animate-fade-in {
        animation: fadeIn 0.5s ease-out;
    }
    
    .animate-slide-up {
        animation: slideInUp 0.6s ease-out forwards;
    }
    
    /* ===== RESPONSIVE DESIGN ===== */
    
    /* Small phones (320px - 374px) */
    @media (max-width: 374px) {
        .container-custom {
            padding-left: 6px;
            padding-right: 6px;
        }
        
        .blog-hero-title {
            font-size: 22px;
        }
        
        .blog-hero-subtitle {
            font-size: 13px;
        }
        
        .blog-posts-grid {
            grid-template-columns: 1fr;
        }
        
        .blog-post-image {
            height: 160px;
        }
        
        .recent-post-item {
            flex-direction: column;
            gap: 8px;
        }
        
        .recent-post-image {
            width: 100%;
            height: 100px;
        }
        
        .blog-search-input {
            padding: 12px 44px 12px 12px;
        }
        
        .blog-search-button {
            width: 32px;
            height: 32px;
            font-size: 14px;
        }
    }
    
    /* Medium phones (375px - 424px) */
    @media (min-width: 375px) and (max-width: 424px) {
        .blog-posts-grid {
            grid-template-columns: 1fr;
        }
        
        .blog-post-image {
            height: 180px;
        }
    }
    
    /* Large phones (425px - 575px) */
    @media (min-width: 425px) and (max-width: 575px) {
        .blog-posts-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
    }
    
    /* Tablets (576px - 767px) */
    @media (min-width: 576px) {
        .container-custom {
            padding-left: 16px;
            padding-right: 16px;
        }
        
        .blog-hero-title {
            font-size: 32px;
        }
        
        .blog-hero-subtitle {
            font-size: 16px;
        }
        
        .blog-posts-grid {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .blog-post-image {
            height: 200px;
        }
        
        .blog-post-title {
            font-size: 18px;
        }
    }
    
    /* Medium tablets (768px - 991px) */
    @media (min-width: 768px) {
        .blog-hero-title {
            font-size: 36px;
        }
        
        .blog-hero-subtitle {
            font-size: 18px;
        }
        
        .blog-posts-grid {
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        }
        
        .blog-post-image {
            height: 220px;
        }
    }
    
    /* Large tablets (992px - 1199px) */
    @media (min-width: 992px) {
        .blog-hero-title {
            font-size: 40px;
        }
        
        .sticky-sidebar {
            position: sticky;
            top: 80px;
        }
    }
    
    /* Desktop (1200px and above) */
    @media (min-width: 1200px) {
        .blog-posts-grid {
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        }
        
        .blog-post-image {
            height: 240px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-3 mt-2">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'home' %}"><i class="bi bi-house"></i> Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Blog</li>
    </ol>
</nav>

<!-- Blog Hero Section -->
<section class="blog-hero-section animate-fade-in">
    <div class="container-custom">
        <div class="blog-hero-content">
            <div class="blog-hero-badge">
                <i class="bi bi-journal-text"></i>
                <span>Latest Insights & Updates</span>
            </div>
            
            <h1 class="blog-hero-title">Baysoko Blog</h1>
            <p class="blog-hero-subtitle">
                Discover tips, guides, and insights about buying and selling in your community
            </p>
            
            <!-- Enhanced Search Section -->
            <div class="blog-search-container">
                <form method="get" action="{% url 'blog:post-list' %}" class="blog-search-form" role="search" aria-label="Search blog posts">
                    <div class="blog-search-wrapper">
                        <input type="search" 
                               name="q" 
                               id="blog-search-input"
                               class="blog-search-input" 
                               placeholder="Search blog posts..."
                               value="{{ request.GET.q|default:'' }}"
                               aria-label="Search blog posts"
                               autocomplete="off">
                        <button type="button" id="blog-search-button" class="blog-search-button" aria-label="Search" title="Search">
                            <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                    
                    <select name="category" class="form-select blog-search-category" aria-label="Filter by category">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:'s' %}selected{% endif %}>{{ category.name }}</option>
                        {% endfor %}
                    </select>
                    
                    <!-- Live Search Results -->
                    <div id="search-results" class="search-results-panel" aria-live="polite" role="region" aria-label="Live search results"></div>
                    
                    <!-- Search History -->
                    <div id="search-history" class="search-history-container" aria-label="Search history"></div>
                </form>
            </div>
        </div>
    </div>
</section>

<div class="container-custom py-3">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            {% if user.is_authenticated and user_posts %}
            <!-- User Posts Section -->
            <div class="user-posts-card animate-slide-up">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0" style="font-weight: 800; color: var(--text-primary);">
                        <i class="bi bi-person-badge me-2"></i>My Blog Posts
                    </h5>
                    <a href="{% url 'blog:post-create' %}" class="btn-custom btn-sm btn-primary">
                        <i class="bi bi-plus-circle me-1"></i> New Post
                    </a>
                </div>
                
                <div class="user-posts-list">
                    {% for post in user_posts %}
                    <div class="user-post-item animate-slide-up" style="animation-delay: {{ forloop.counter0|add:0.1 }}s;">
                        <div class="user-post-info">
                            <h6>
                                <a href="{% url 'blog:post-detail' post.slug %}">
                                    {{ post.title|truncatechars:60 }}
                                </a>
                            </h6>
                            <div class="user-post-meta">
                                <span class="user-post-status {{ post.status }}">
                                    {{ post.get_status_display }}
                                </span>
                                <small>
                                    <i class="bi bi-calendar"></i> {{ post.created_at|date:"M d, Y" }}
                                </small>
                                {% if post.view_count > 0 %}
                                <small>
                                    <i class="bi bi-eye"></i> {{ post.view_count }}
                                </small>
                                {% endif %}
                                {% if post.comment_count > 0 %}
                                <small>
                                    <i class="bi bi-chat"></i> {{ post.comment_count }}
                                </small>
                                {% endif %}
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-three-dots"></i>
                            </button>
                            <ul class="dropdown-menu" style="z-index: 10050 !important;">
                                <li><a class="dropdown-item" href="{% url 'blog:post-detail' post.slug %}"><i class="bi bi-eye me-2"></i>View</a></li>
                                <li><a class="dropdown-item" href="{% url 'blog:post-update' post.slug %}"><i class="bi bi-pencil me-2"></i>Edit</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="{% url 'blog:post-delete' post.slug %}"><i class="bi bi-trash me-2"></i>Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                {% if user_posts|length > 2 %}
                <div class="text-center mt-3">
                    <a href="{% url 'blog:user-posts' %}" class="btn-custom btn-ghost btn-sm">
                        View All My Posts
                    </a>
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Blog Posts Section Header -->
            <div class="section-header animate-slide-up">
                <h4>
                    <i class="bi bi-journals"></i>
                    Latest Posts
                    {% if posts %}
                    <span class="badge bg-primary" style="font-size: 12px; margin-left: 8px;">{{ total_posts }}</span>
                    {% endif %}
                </h4>
                
                {% if user.is_authenticated %}
                <a href="{% url 'blog:post-create' %}" class="btn-custom btn-primary">
                    <i class="bi bi-plus-circle me-2"></i>Write a Post
                </a>
                {% endif %}
            </div>
            
            <!-- Blog Posts Grid -->
            {% if posts %}
            <div class="blog-posts-grid">
                {% for post in posts %}
                <article class="blog-post-card animate-slide-up" style="animation-delay: {{ forloop.counter0|add:0.1 }}s;">
                    <div class="blog-post-image">
                        <img src="{{ post.get_image_url|default:'/static/images/blog_placeholder.svg' }}" 
                             alt="{{ post.title }}"
                             loading="lazy">
                        
                        <div class="blog-post-badges">
                            {% if post.category %}
                            <span class="blog-category-tag">
                                <i class="bi bi-folder"></i>
                                {{ post.category.name }}
                            </span>
                            {% endif %}
                            
                            {% if post.featured %}
                            <span class="blog-featured-tag">
                                <i class="bi bi-star"></i> Featured
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="blog-post-content">
                        <h3 class="blog-post-title">
                            <a href="{% url 'blog:post-detail' post.slug %}">
                                {{ post.title }}
                            </a>
                        </h3>
                        
                        <p class="blog-post-excerpt">
                            {{ post.excerpt|default:post.content|striptags|truncatechars:120 }}
                        </p>
                        
                        <div class="blog-post-meta">
                            <div class="blog-post-author">
                                {% if post.author.profile.profile_picture %}
                                <img src="{{ post.author.profile.profile_picture.url }}" 
                                     alt="{{ post.author.username }}" 
                                     class="blog-author-avatar">
                                {% else %}
                                <div class="blog-author-avatar" style="background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 12px;">
                                    {{ post.author.username|first|upper }}
                                </div>
                                {% endif %}
                                <span>{{ post.author.username }}</span>
                            </div>
                            
                            <div class="blog-post-stats">
                                {% if post.view_count > 0 %}
                                <span class="blog-post-stat views">
                                    <i class="bi bi-eye"></i>
                                    {{ post.view_count }}
                                </span>
                                {% endif %}
                                {% if post.like_count > 0 %}
                                <span class="blog-post-stat likes">
                                    <i class="bi bi-heart"></i>
                                    {{ post.like_count }}
                                </span>
                                {% endif %}
                                {% if post.comment_count > 0 %}
                                <span class="blog-post-stat comments">
                                    <i class="bi bi-chat"></i>
                                    {{ post.comment_count }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </article>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if is_paginated %}
            <div class="blog-pagination animate-fade-in">
                {% if page_obj.has_previous %}
                <a href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" 
                   class="page-link" title="First page">
                    <i class="bi bi-chevron-double-left"></i>
                </a>
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" 
                   class="page-link" title="Previous">
                    <i class="bi bi-chevron-left"></i>
                </a>
                {% else %}
                <span class="page-link disabled">
                    <i class="bi bi-chevron-left"></i>
                </span>
                {% endif %}
                
                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <span class="page-link active">{{ num }}</span>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" 
                       class="page-link">{{ num }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" 
                   class="page-link" title="Next">
                    <i class="bi bi-chevron-right"></i>
                </a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" 
                   class="page-link" title="Last page">
                    <i class="bi bi-chevron-double-right"></i>
                </a>
                {% else %}
                <span class="page-link disabled">
                    <i class="bi bi-chevron-right"></i>
                </span>
                {% endif %}
            </div>
            {% endif %}
            
            {% else %}
            <!-- Empty State -->
            <div class="empty-blog-state animate-slide-up">
                <div class="empty-blog-icon">
                    <i class="bi bi-journal-text"></i>
                </div>
                <h3 class="empty-blog-title">No blog posts found</h3>
                <p class="empty-blog-description">
                    {% if request.GET.q or request.GET.category %}
                    No posts matching your search criteria. Try different keywords or categories.
                    {% else %}
                    No blog posts have been published yet. Check back later!
                    {% endif %}
                </p>
                <div class="d-flex gap-2 justify-content-center">
                    {% if request.GET.q or request.GET.category %}
                    <a href="{% url 'blog:post-list' %}" class="btn-custom btn-primary">
                        <i class="bi bi-grid me-2"></i>View All Posts
                    </a>
                    {% endif %}
                    {% if user.is_authenticated %}
                    <a href="{% url 'blog:post-create' %}" class="btn-custom btn-ghost">
                        <i class="bi bi-pencil me-2"></i>Write First Post
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="sticky-sidebar">
                <!-- Create Post Card -->
                {% if user.is_authenticated %}
                <div class="create-post-card animate-slide-up">
                    <i class="bi bi-pencil-square"></i>
                    <h5>Share Your Knowledge</h5>
                    <p>Write a blog post and help others in the community</p>
                    <a href="{% url 'blog:post-create' %}" class="btn-custom">
                        Create New Post
                    </a>
                </div>
                {% endif %}
                
                <!-- Categories -->
                <div class="info-card animate-slide-up" style="animation-delay: 0.1s;">
                    <h5 class="sidebar-title">
                        <i class="bi bi-folder"></i>
                        Categories
                    </h5>
                    <ul class="categories-list">
                        {% for category in categories %}
                        <li class="category-item {% if request.GET.category == category.id|stringformat:'s' %}active{% endif %}">
                            <a href="?category={{ category.id }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
                                <span>{{ category.name }}</span>
                                <span class="category-count">{{ category.post_count }}</span>
                            </a>
                        </li>
                        {% empty %}
                        <li class="category-item">
                            <span class="text-muted" style="font-size: 13px;">No categories yet</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                
                <!-- Featured Posts -->
                {% if featured_posts %}
                <div class="info-card animate-slide-up" style="animation-delay: 0.2s;">
                    <h5 class="sidebar-title">
                        <i class="bi bi-star"></i>
                        Featured Posts
                    </h5>
                    <ul class="recent-posts-list">
                        {% for post in featured_posts %}
                        <li class="recent-post-item">
                            <img src="{{ post.get_image_url|default:'/static/images/blog_placeholder.svg' }}" 
                                 alt="{{ post.title }}" 
                                 class="recent-post-image">
                            <div class="recent-post-info">
                                <h6 class="recent-post-title">
                                    <a href="{% url 'blog:post-detail' post.slug %}">
                                        {{ post.title|truncatechars:50 }}
                                    </a>
                                </h6>
                                <div class="recent-post-date">
                                    <i class="bi bi-calendar"></i>
                                    {{ post.published_at|date:"M d, Y" }}
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                <!-- Recent Posts -->
                {% if recent_posts %}
                <div class="info-card animate-slide-up" style="animation-delay: 0.3s;">
                    <h5 class="sidebar-title">
                        <i class="bi bi-clock"></i>
                        Recent Posts
                    </h5>
                    <ul class="recent-posts-list">
                        {% for post in recent_posts %}
                        <li class="recent-post-item">
                            <img src="{{ post.get_image_url|default:'/static/images/blog_placeholder.svg' }}" 
                                 alt="{{ post.title }}" 
                                 class="recent-post-image">
                            <div class="recent-post-info">
                                <h6 class="recent-post-title">
                                    <a href="{% url 'blog:post-detail' post.slug %}">
                                        {{ post.title|truncatechars:50 }}
                                    </a>
                                </h6>
                                <div class="recent-post-date">
                                    <i class="bi bi-calendar"></i>
                                    {{ post.published_at|date:"M d, Y" }}
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Blog list page loaded with enhanced search');
        
        // ===== ENHANCED SEARCH FUNCTIONALITY =====
        const searchInput = document.getElementById('blog-search-input');
        const searchButton = document.getElementById('blog-search-button');
        const categorySelect = document.querySelector('select[name="category"]');
        const searchResultsDiv = document.getElementById('search-results');
        const searchHistoryDiv = document.getElementById('search-history');
        const searchForm = document.querySelector('.blog-search-form');
        
        // Initialize search history
        const SEARCH_HISTORY_KEY = 'blog_search_history';
        let isClearMode = false;
        
        // Update search button mode (arrow for search, x for clear)
        function updateSearchButtonMode() {
            if (!searchInput || !searchButton) return;
            
            const hasValue = searchInput.value && searchInput.value.trim().length > 0;
            
            if (hasValue) {
                // Switch to clear mode
                searchButton.innerHTML = '<i class="bi bi-x-lg"></i>';
                searchButton.setAttribute('title', 'Clear search');
                searchButton.classList.add('clear-mode');
                isClearMode = true;
            } else {
                // Switch to search mode
                searchButton.innerHTML = '<i class="bi bi-arrow-right"></i>';
                searchButton.setAttribute('title', 'Search');
                searchButton.classList.remove('clear-mode');
                isClearMode = false;
            }
        }
        
        // Show/hide search results
        function showSearchResults(show = true) {
            if (!searchResultsDiv) return;
            if (show) {
                searchResultsDiv.classList.add('visible');
            } else {
                searchResultsDiv.classList.remove('visible');
            }
        }
        
        // Clear search functionality
        function clearSearch() {
            if (searchInput) {
                searchInput.value = '';
                searchInput.focus();
            }
            updateSearchButtonMode();
            showSearchResults(false);
            searchResultsDiv.innerHTML = '';
            renderSearchHistory();
        }
        
        // Submit search functionality
        function submitSearch() {
            if (searchForm) {
                searchForm.submit();
            }
        }
        
        // Initialize search functionality
        if (searchInput && searchButton) {
            updateSearchButtonMode();
            
            // Input event for live search
            searchInput.addEventListener('input', function() {
                updateSearchButtonMode();
                triggerLiveSearch();
            });
            
            // Focus event
            searchInput.addEventListener('focus', function() {
                renderSearchHistory();
                if (this.value.trim()) {
                    triggerLiveSearch();
                }
            });
            
            // Search button click
            searchButton.addEventListener('click', function() {
                if (isClearMode) {
                    clearSearch();
                } else {
                    submitSearch();
                }
            });
            
            // Enter key to submit
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    submitSearch();
                }
            });
        }
        
        // Auto-submit on category change
        if (categorySelect) {
            categorySelect.addEventListener('change', function() {
                this.form.submit();
            });
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // '/' to focus search
            if (e.key === '/' && !e.target.matches('input, textarea, select')) {
                e.preventDefault();
                if (searchInput) {
                    searchInput.focus();
                }
            }
            
            // Escape to clear search results
            if (e.key === 'Escape' && searchInput && document.activeElement === searchInput) {
                if (searchInput.value.trim()) {
                    clearSearch();
                } else {
                    showSearchResults(false);
                }
            }
        });
        
        // ===== ENHANCED LIVE SEARCH =====
        let searchTimeout = null;
        
        function triggerLiveSearch() {
            if (searchTimeout) clearTimeout(searchTimeout);
            searchTimeout = setTimeout(performLiveSearch, 300);
        }
        
        function performLiveSearch() {
            if (!searchInput || !searchResultsDiv) return;
            
            const query = searchInput.value.trim();
            const category = categorySelect ? categorySelect.value : '';
            
            if (!query) {
                showSearchResults(false);
                renderSearchHistory();
                return;
            }
            
            const url = `{% url 'blog:post-search-json' %}?q=` + encodeURIComponent(query) + 
                       (category ? '&category=' + encodeURIComponent(category) : '');
            
            fetch(url)
                .then(res => {
                    if (!res.ok) throw new Error('Network response was not ok');
                    return res.json();
                })
                .then(data => {
                    const results = data.results || [];
                    renderSearchResults(results);
                    showSearchResults(true);
                    
                    // Add to search history if we have results
                    if (results.length > 0) {
                        addToSearchHistory(query);
                    }
                })
                .catch(err => {
                    console.error('Live search error:', err);
                    searchResultsDiv.innerHTML = `
                        <div class="text-center p-3" style="color: rgba(255,255,255,0.7); font-size: 13px;">
                            <i class="bi bi-exclamation-triangle me-1"></i>
                            Error loading results
                        </div>
                    `;
                    showSearchResults(true);
                });
        }
        
        function renderSearchResults(results) {
            if (!searchResultsDiv) return;
            
            if (!results || results.length === 0) {
                searchResultsDiv.innerHTML = `
                    <div class="text-center p-3" style="color: rgba(255,255,255,0.7); font-size: 13px;">
                        <i class="bi bi-search me-1"></i>
                        No matching posts found
                    </div>
                `;
                searchResultsDiv.classList.remove('has-many-results');
                return;
            }
            
            // Check if we have more than 3 results
            const hasManyResults = results.length > 3;
            if (hasManyResults) {
                searchResultsDiv.classList.add('has-many-results');
            } else {
                searchResultsDiv.classList.remove('has-many-results');
            }
            
            const resultsCount = `<div class="results-count">Found ${results.length} result${results.length === 1 ? '' : 's'}</div>`;
            
            const resultsHtml = results.map((result, index) => `
                <a href="/blog/post/${result.slug}/" class="search-result-item">
                    <img src="${result.image_url || '/static/images/blog_placeholder.svg'}" 
                         alt="${result.title}"
                         class="search-result-image"
                         loading="lazy">
                    <div class="search-result-content">
                        <div class="search-result-title">${result.title}</div>
                        ${result.excerpt ? `<div class="search-result-excerpt">${result.excerpt}</div>` : ''}
                        ${result.category ? `
                            <div class="search-result-meta">
                                <i class="bi bi-folder"></i>
                                <span>${result.category}</span>
                            </div>
                        ` : ''}
                    </div>
                </a>
            `).join('');
            
            searchResultsDiv.innerHTML = resultsCount + resultsHtml;
        }
        
        // ===== ENHANCED SEARCH HISTORY =====
        function getSearchHistory() {
            try {
                const history = localStorage.getItem(SEARCH_HISTORY_KEY);
                return history ? JSON.parse(history) : [];
            } catch (e) {
                console.error('Error reading search history:', e);
                return [];
            }
        }
        
        function saveSearchHistory(history) {
            try {
                localStorage.setItem(SEARCH_HISTORY_KEY, JSON.stringify(history));
            } catch (e) {
                console.error('Error saving search history:', e);
            }
        }
        
        function addToSearchHistory(query) {
            if (!query || !query.trim()) return;
            
            const trimmedQuery = query.trim();
            let history = getSearchHistory();
            
            // Remove if already exists
            history = history.filter(item => item !== trimmedQuery);
            
            // Add to beginning
            history.unshift(trimmedQuery);
            
            // Keep only last 6 items
            if (history.length > 6) {
                history = history.slice(0, 6);
            }
            
            saveSearchHistory(history);
            renderSearchHistory();
        }
        
        function removeFromSearchHistory(query) {
            let history = getSearchHistory();
            history = history.filter(item => item !== query);
            saveSearchHistory(history);
            renderSearchHistory();
        }
        
        function clearSearchHistory() {
            if (confirm('Clear all search history?')) {
                saveSearchHistory([]);
                renderSearchHistory();
            }
        }
        
        function renderSearchHistory() {
            if (!searchHistoryDiv) return;
            
            const history = getSearchHistory();
            
            if (history.length === 0) {
                searchHistoryDiv.innerHTML = '';
                return;
            }
            
            const historyItems = history.map(item => `
                <div class="search-history-item">
                    <span class="history-term" onclick="searchFromHistory('${item.replace(/'/g, "\\'")}')">
                        ${item}
                    </span>
                    <button type="button" class="remove-history-btn" onclick="removeHistoryItem('${item.replace(/'/g, "\\'")}', event)">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
            `).join('');
            
            searchHistoryDiv.innerHTML = `
                <div class="search-history-title">
                    <i class="bi bi-clock-history"></i>
                    Recent Searches
                    <button type="button" class="btn btn-link btn-sm ms-auto p-0" style="color: rgba(255,255,255,0.6); font-size: 11px;" onclick="clearAllHistory()">
                        Clear all
                    </button>
                </div>
                <div class="search-history-list">
                    ${historyItems}
                </div>
            `;
        }
        
        // Global functions for inline onclick handlers
        window.searchFromHistory = function(term) {
            if (searchInput) {
                searchInput.value = term;
                searchInput.focus();
                updateSearchButtonMode();
                triggerLiveSearch();
            }
        };
        
        window.removeHistoryItem = function(term, event) {
            if (event) event.stopPropagation();
            removeFromSearchHistory(term);
        };
        
        window.clearAllHistory = function() {
            clearSearchHistory();
        };
        
        // Save search on form submit
        if (searchForm) {
            searchForm.addEventListener('submit', function(e) {
                if (searchInput && searchInput.value.trim()) {
                    addToSearchHistory(searchInput.value.trim());
                }
            });
        }
        
        // Hide search results when clicking outside
        document.addEventListener('click', function(e) {
            if (!searchForm.contains(e.target)) {
                showSearchResults(false);
            }
        });
        
        // Initialize
        renderSearchHistory();
        updateSearchButtonMode();
        
        // ===== ADDITIONAL ENHANCEMENTS =====
        
        // Smooth animations for cards
        const blogCards = document.querySelectorAll('.blog-post-card');
        blogCards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.05}s`;
        });
        
        // Tooltips
        if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
            const tooltips = document.querySelectorAll('[title]');
            tooltips.forEach(tooltip => {
                new bootstrap.Tooltip(tooltip);
            });
        }
        
        // Responsive adjustments
        function adjustForResponsive() {
            if (searchResultsDiv && window.innerWidth < 768) {
                searchResultsDiv.style.maxHeight = '280px';
            }
        }
        
        adjustForResponsive();
        window.addEventListener('resize', adjustForResponsive);
        
        // Pre-focus search if there's a search query
        if (searchInput && searchInput.value.trim()) {
            updateSearchButtonMode();
            setTimeout(() => {
                triggerLiveSearch();
            }, 500);
        }
        
        // Ensure search results are visible above hero
        const heroSection = document.querySelector('.blog-hero-section');
        if (heroSection) {
            heroSection.style.zIndex = '1';
        }
    });
</script>
{% endblock %}